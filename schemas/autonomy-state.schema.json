{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/v11/schemas/autonomy-state.schema.json",
  "title": "V11 Autonomy State",
  "description": "Schema for .autonomy-state â€” per-project autonomy level and grants",
  "type": "object",
  "properties": {
    "level": {
      "type": "integer",
      "minimum": 0,
      "maximum": 4,
      "description": "Autonomy level: A0=manual, A1=guided, A2=supervised, A3=trusted, A4=autonomous"
    },
    "grants": {
      "type": "array",
      "items": { "$ref": "#/$defs/grant" },
      "description": "File pattern grants for A2+ levels"
    },
    "approved_categories": {
      "type": "array",
      "items": {
        "enum": ["typescript", "python", "shell", "markdown", "config", "git", "docker", "npm"]
      },
      "description": "Pre-approved file categories for A1+ levels"
    },
    "high_risk_history": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Previously approved high-risk patterns for A4 auto-approval"
    },
    "success_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Consecutive successful actions (for escalation tracking)"
    },
    "error_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Recent error count (for de-escalation)"
    },
    "last_escalation": {
      "type": "string",
      "format": "date-time"
    },
    "last_deescalation": {
      "type": "string",
      "format": "date-time"
    }
  },
  "required": ["level"],
  "$defs": {
    "grant": {
      "type": "object",
      "properties": {
        "pattern": {
          "type": "string",
          "minLength": 1,
          "description": "File path pattern to match"
        },
        "type": {
          "enum": ["glob", "regex", "prefix"],
          "default": "glob",
          "description": "Pattern matching strategy"
        },
        "granted_at": {
          "type": "string",
          "format": "date-time"
        },
        "reason": {
          "type": "string",
          "description": "Why this grant was approved"
        }
      },
      "required": ["pattern"],
      "additionalProperties": false
    }
  }
}
